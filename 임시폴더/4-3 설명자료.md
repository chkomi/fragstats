# 4-3. 그룹 가중치와 변별력(Discriminability) 연계 설명

본 문서는 “지표 그룹화 후 산정된 가중치(지표·그룹 레벨)”가 변별력 분석(클래스 간 차이)에 어떻게 쓰이는지, 현재 파이프라인과 대안 방식을 수식과 예시로 자세히 설명합니다.


## 1) 용어와 표기
- 레이어 ℓ ∈ L: 예) Nongeup(논), Pibok, Toyang3, Infra
- 클래스 c ∈ {cls_1, cls_9}: 두 기준 클래스(저·고)
- 그룹 g ∈ G: 개념별 묶음(예: 면적·밀도, 형상, 연결성, 분포 등)
- 지표 j ∈ I_g: 그룹 g에 속한 지표(예: PD, LPI, ED, AI …)
- 표준화 값 x_{ℓ,c,j}: 레이어 ℓ, 클래스 c, 지표 j의 정방향 스케일 값(0~1)
- 엔트로피 기반 지표 가중치 w_j^(g): 그룹 g 내부에서의 지표 가중치(Σ_{j∈I_g} w_j^(g) = 1)
- 그룹 상위 가중치 W_g: 그룹 g의 상위(Top-level) 비중(예: 면적·밀도 38.09% → W_면적밀도 = 0.3809)


## 2) 단계별 파이프라인(현행)
### (1) 지표 표준화
- 방향성 맞춤(높을수록 좋음/나쁨 일관화) → 0~1 범위 스케일링.

### (2) 엔트로피 가중치로 “지표 가중치” 산정(그룹 내부)
- 정규화: p_{ℓ,c,j} = x_{ℓ,c,j} / Σ_{ℓ'} x_{ℓ',c,j}
- 엔트로피: e_j = -k Σ_{ℓ,c} p_{ℓ,c,j} ln p_{ℓ,c,j}, k = 1/ln(|L|·|C|)
- 정보량: d_j = 1 - e_j
- 그룹 내부 정규화: w_j^(g) = d_j / Σ_{k∈I_g} d_k

### (3) 그룹 점수 산정(클래스별)
- 그룹 점수(레이어 ℓ, 클래스 c, 그룹 g):
  Score_{ℓ,c,g} = Σ_{j∈I_g} w_j^(g) · x_{ℓ,c,j}
- 해석: 그룹 g 내 지표들을 엔트로피 가중합한 클래스별 대표 점수.

### (4) 변별력(Discriminability) 산정 — 현행식(비가중 합)
- 그룹별 변별력(레이어 ℓ, 그룹 g):
  D_{ℓ,g} = |Score_{ℓ,cls_9,g} − Score_{ℓ,cls_1,g}|
- 전체 변별력(레이어 ℓ):
  D_{ℓ,total} = Σ_{g∈G} D_{ℓ,g}
- 특징: 그룹 상위 가중치 W_g는 변별력 합산에 곱하지 않음(현 문서 흐름 기준).

### (5) 다그룹 결합(지도·최종 점수)
- 레이어 종합 점수: S_ℓ = Σ_{g∈G} W_g · Score_{ℓ,overall,g}
  - Score_{ℓ,overall,g}는 (필요 시) 클래스 종합 또는 특정 클래스/시나리오 스코어.
  - 지도 합성·의사결정 단계에서 그룹 상위 가중치 W_g가 적용됨.


## 3) 수치 예시(Nongeup, 면적·밀도 그룹)
- 표 5(그룹 점수)에서:
  - Score_{Nongeup, cls_9, 면적·밀도} = 0.9170
  - Score_{Nongeup, cls_1, 면적·밀도} = 0.2188
- 그룹별 변별력(현행식):
  - D_{Nongeup, 면적·밀도} = |0.9170 − 0.2188| = 0.6982
- 전체 변별력(표 7): D_{Nongeup, total} = 1.7535 (여러 그룹 D의 단순합)
- 그룹 상위 가중치(예): W_면적·밀도 = 0.3809
  - 이 값은 변별력 합산에는 사용되지 않고, 지도/최종 점수 결합(5단계)에 사용됨.


## 4) 왜 변별력 합산에 W_g를 곱하지 않았나(현행의 해석)
- 목적 분리: 변별력은 "클래스 구분력이 얼마나 큰가"를 그룹별로 순수하게 측정. 상위 가중치가 개입하면, 그룹의 개념적 중요도와 구분력이 혼합되어 해석이 불명확해질 수 있음.
- 진단 도구로서의 투명성: D_{ℓ,g}는 그 자체로 각 그룹 축에서의 분리 정도를 직관적으로 보여줌.


## 5) 대안: 가중 변별력(정책/목표 반영형)
- 정의: D'_{ℓ,total} = Σ_{g∈G} W_g · D_{ℓ,g}
- 장점: “우리 사업에서 더 중요한 그룹”의 변별력을 더 중시.
- 단점: 변별력과 정책 가중이 섞여 원인 진단이 어렵고, W_g 추정의 불확실성에 민감.
- 권장 사용처: 의사결정 점수화를 직접 최적화할 때(예: 분류 성능·효용 최대화).


## 6) 엔트로피 가중치(그룹 내부)와 변별력의 연결 고리
- 연결 1: w_j^(g)가 클수록 해당 지표가 그룹 점수 Score_{ℓ,c,g}에 더 크게 기여.
- 연결 2: 두 클래스 점수의 차이 D_{ℓ,g}는 곧 “그룹 내 지표들의 (엔트로피 기반) 가중합 차이”.
- 연결 3: 따라서 그룹 가중치 설계를 바꾸면 Score_{ℓ,c,g}가 바뀌고, 결과적으로 D_{ℓ,g}도 바뀜.


## 7) 구현 절차(알고리즘 요약)
1. 표준화: 모든 x_{ℓ,c,j}를 0~1, 정방향으로 변환.
2. 엔트로피: 지표별 d_j 계산 후 그룹 내부 정규화로 w_j^(g) 산출.
3. 그룹 점수: Score_{ℓ,c,g} = Σ w_j^(g)·x_{ℓ,c,j}
4. 변별력: D_{ℓ,g} = |Score_{ℓ,cls_9,g} − Score_{ℓ,cls_1,g}|, D_{ℓ,total} = Σ_g D_{ℓ,g}
5. 지도/최종 점수: S_ℓ = Σ_g W_g · Score_{ℓ,overall,g} (필요 시 W_g는 균등/데이터/전문가 기반)


## 8) 체크리스트(정합성·실무 팁)
- 방향성 통일: 지표가 “높을수록 좋음/나쁨”이 섞이지 않도록 반전 처리.
- 0 분산 지표 제거: d_j ≈ 0이면 w_j^(g)도 0에 수렴 → 영향 미미.
- 그룹 내부 정규화 확인: Σ_{j∈I_g} w_j^(g) = 1 유지.
- 변별력 해석: D_{ℓ,g}가 큰 그룹이 해당 레이어의 클래스 차이를 더 잘 드러냄.
- 상위 가중치 사용처: 변별력 산정이 아니라, 지도/의사결정 결합 단계에서 사용(현행).


## 9) 요약
- 그룹화된 지표 가중치(엔트로피)는 “그룹 점수”를 만드는 데 직접 쓰이고, 변별력은 이 그룹 점수의 클래스 간 차이로 계산됩니다.
- 그룹 상위 가중치 W_g는 변별력 합산에 곱하지 않고, 최종 지도/점수 결합 단계에 사용됩니다. 필요하면 대안식 Σ W_g·D_{ℓ,g}로 정책 가중형 변별력을 만들 수 있습니다.

